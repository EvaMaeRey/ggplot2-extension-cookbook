
  - [ggplot2-extension-cookbook](#ggplot2-extension-cookbook)
  - [Preface and acknowledgements](#preface-and-acknowledgements)
  - [geom and stat layers](#geom-and-stat-layers)
      - [one geom per row in a input data
        frame](#one-geom-per-row-in-a-input-data-frame)
      - [one geom summarizing many rows in an input data frame,
        group-wise
        computation](#one-geom-summarizing-many-rows-in-an-input-data-frame-group-wise-computation)
      - [a geom defined by many rows, generated by a single row of the
        input data
        frame](#a-geom-defined-by-many-rows-generated-by-a-single-row-of-the-input-data-frame)
      - [between-group computation](#between-group-computation)
      - [a geom defined by an sf geometry
        column](#a-geom-defined-by-an-sf-geometry-column)
      - [One geom per row, but interdependence
        (waterfall)](#one-geom-per-row-but-interdependence-waterfall)
  - [summarize first, then interdependence
    …](#summarize-first-then-interdependence-)
  - [repurposing an existing stats](#repurposing-an-existing-stats)
      - [piggybacking](#piggybacking)
      - [Adding defaults to existing stats via ggproto
        editing](#adding-defaults-to-existing-stats-via-ggproto-editing)
  - [modifying ggplot() function (data
    transformation)](#modifying-ggplot-function-data-transformation)
  - [modifying ggraph() function](#modifying-ggraph-function)
  - [wrapping fiddly functions (annotate and
    theme)](#wrapping-fiddly-functions-annotate-and-theme)
  - [defining theme…](#defining-theme)
  - [What about formal testing?](#what-about-formal-testing)

<!-- README.md is generated from README.Rmd. Please edit that file -->

# ggplot2-extension-cookbook

<!-- badges: start -->

<!-- badges: end -->

*The ggplot2 Extension Cookbook* aims to provide ggplot2 extension
strategies in a consistent and accessible way.

We group the content by extension type, provide demonstrations of their
use, and then link (for now) to the code that defines them. In that
material, I’ll try to stick to a formula to orient you to the ggplot2
extension:

  - Step 0: get job done with ‘base’ ggplot2
  - Step 1: Write a function for the ‘compute’
  - Step 2: Pass the compute to ggproto
  - Step 3: Pass ggproto to a user-facing function for use in a ggplot()
    pipeline
  - Step 4: Try out/test/enjoy\!

# Preface and acknowledgements

Thomas Lin Pederson’s January 2020 talk ‘Extending your ability to
extend ggplot2’, which I attended in seated on the floor of a packed out
ballroom, had the important central message - “you can be a ggplot2
extender”. And since then, I aimed to be an extender, and now I in turn
want to extend that message to you\!

I’d been using ggplot2 since about 2017, and in general, really enjoyed
the user interface. In general, the syntax does a fantastic job at
letting users compose their plots bit-by-bit, closely resembling to how
you might sketch out a plot on a notepad or blackboard, and describing
your decisions as you go to yourself or a colleague. Or as Thomas Lin
Pederson has also said, ‘ggplot2 lets you *speak your plot into
existence*’. And perhaps a little less eloquently by Hadley Wickham’s,
the ggplot2 author, “This is what I’m thinking; your the computer, now
go and do it\!” (paraphrase of the author paraphrasing how he was
thinking about how data viz should feel — even before ggplot2 existed)

But there were pain points when using ‘base’ ggplot2; for me this was
mostly when a geom didn’t exist for doing some compute in the
background, but maybe wanted that compute done over and over, and it
would be a slough to do it over and over upstream to the plotting
environment. This pre-computation problem felt manageable in classroom
setting which I was in through early 2020 but when I moved to a
primarily analytic role at West Point — where the volume of analysis was
simply higher and turn around times needed to be faster — I felt the
problem much more acutely. (Overnight, I went from weak preference for
geom\_col - to strong preference for geom\_bar\!)

Extension seemed to offer the solution to the problem and it’s
application seemed more pressing in an analyst role.

However, to get the desired magical ggplot2 behavior that I was seeking,
just for one geom took many months (most of 2020) facing failure and
frustration along the way. If I weren’t so convinced of the efficiency
gains that it would eventually yield, I’d likely have given up.

Now, recognizing this, I think there is space for more ggplot2 extension
reference materials targeted at seasoned ggplot2 and R users. *ggplot2
Extension Cookbook* might serve this group.

I’m grateful for several expediences and the efforts of others that have
refined these new materials. First, just after getting my own feet wet
in extension, I had the chance to work on extension with students in the
context of independent studies. Our focus was the same type of extension
that Pederson demonstrated – a geom that used a Stat to do some
computational work, and then inherited the rest of its behavior from a
more primitive geom. Working with first and second year undergrad
students meant that I had to think about and formulate workflow - where
reference material would even be accessibility to very new R users. As
veterans of just one or two stats classes that used R and ggplot2, what
would they find familiar and accessible? What might we be able to
de-emphasize and still succeed? I’m grateful to these This worked with
students and I had a chance to refine it further.

The following steps emerged and persisted into our tutorial formula:

  - Step 0: get job done with ‘base’ ggplot2
  - Step 1: Write a function for the ‘compute’
  - Step 2: Pass the compute to ggproto
  - Step 3: Pass ggproto to stat/geom/facet function
  - Step 4: Try out/test/enjoy\!

Impressed that … Novice -\> extender, in 4 months.

I wondered how the strategy would perform with experienced R and ggplot2
users. Being an academic, I went down the formal route of devising a
tutorial and formally getting feedback on it via focus groups and a
survey, after refining the tutorial.

I did some research on ggplot2 extension among ggplot2 and R ‘super
users’ and have found that the perhaps this community is under-served,
but with the right materials, more folks could get into ggplot2
extension.

I fielded ‘easy geom recipes’ with a group of statistics educators,
conducting a survey on the resource and also getting feedback via a
focus group.

Among my favorite quotation from the focus groups is something that
validated the efforts but also challenged me:

> it was … easy. And I felt empowered as a result of that…. But you
> know, like, my problem isn’t gonna be that easy.

To that participant, I’d say ‘Sometimes it *is* that easy’. But he is
right, that often times I come to an extension problem and am suprised
that the strategy that I think is going to work doesn’t, or at least not
without a little fiddling.

The feedback on the easy-geom-recipes was collected in March 2023.

So, I’m interested in simply developing new, useful extensions.

To try to make those experiences valuable to others, I follow the
‘recipe’ formula as much as possible so that as strategies morph, one
still knows where one is in the process.

Now to serve the community and for use in this *ggplot2 Extension
Cookbook*, I’m using an in-README documentation strategy for my ggplot2
extension packages so that the development stories are in one place
instead of scattered between package files.

This is made possible via the readme2pkg R package and in turn the knitr
package written by Yihui Xie, whose tools (literate programming,
xaringan and other tools) had already played a huge role in my
relationship with ggplot2. Before arriving at this solution, I felt that
I’d need to divide my energy between moving forward in my own extension
development journey and educator. I’m grateful that with the magic of
knitr::knitr\_code$get() I allow code to sit in the README narrative and
also send it to the required .R directory to serve in the package.

At present, I’ll just show examples of functionality, and then link to
the READMEs for further investigation of the specific recipes/strategies
used.

I’m personally grateful to other ggplot2 extenders and R enthusiasts
that have supported this journey.

I’m also grateful to the ggplot2 development team .

Winston Chang, who gets top billing in the ggplot2 extension vignette,

# geom and stat layers

## one geom per row in a input data frame

``` r
ggxmean::geom_text_coordinate()
```

Note: in this situation, you can also get away with delayed aesthetic
evaluation. See also redefaulting.

## one geom summarizing many rows in an input data frame, group-wise computation

``` r
ggxmean::geom_xy_means()
```

## a geom defined by many rows, generated by a single row of the input data frame

``` r
library(ggcircle)
library(ggcirclepack)
```

## between-group computation

``` r
library(ggols)
```

## a geom defined by an sf geometry column

``` r
library(ggnorthcarolina)
```

## One geom per row, but interdependence (waterfall)

``` r
library(ggwaterfall)
```

# summarize first, then interdependence …

``` r
library(ggcandlestick)
```

# repurposing an existing stats

## piggybacking

``` r
library(ggsmoothfit)
```

## Adding defaults to existing stats via ggproto editing

# modifying ggplot() function (data transformation)

``` r
library(ggverbatim)
```

# modifying ggraph() function

``` r
library(ggedgelist)
```

# wrapping fiddly functions (annotate and theme)

``` r
library(ggstamp)
```

``` r
library(ggcons) # 
```

# defining theme…

``` r
library(ggchalkboard)
```

# What about formal testing?

``` r
library(ggtedius)
```
